<view class="result">
  <view class="card">
    <view class="title">分手风险指数（BHI）</view>
    <view class="bhi">{{result.BHI}} / 100（{{riskTier}}）</view>
    <view class="sub" wx:if="{{!result.hasSafety}}">预计剩余相处时长：<text class="strong">{{rangeRounded[0]}} - {{rangeRounded[1]}}</text> 个月（仅供参考）</view>
    <view class="sub warn" wx:elif="{{result.hasSafety}}">检测到安全风险，优先考虑安全与求助资源。暂不展示时间估计。</view>
    <button size="mini" class="basis-btn" bindtap="toggleBasis">{{showBasis? '收起' : '计算依据'}}</button>
    <view class="basis" wx:if="{{showBasis}}">
      <view>稳定度总分 S：{{basis.S}}</view>
      <view>红旗乘子 M：{{basis.M}}</view>
      <view>已相处时长 t0（月）：{{basis.t0}}</view>
      <view>月风险 λ：{{basis.lambda}}</view>
      <view>权重：冲突{{basis.weights.conflict}} 依恋{{basis.weights.attachment}} 承诺{{basis.weights.commitment}} 仪式{{basis.weights.ritual}} 压力{{basis.weights.stress}} 价值{{basis.weights.values}}</view>
      <view>说明：{{basis.note}}</view>
      <view class="note">公式：
        BHI = clamp(M×(100−S), 0, 100)；
        λ = 0.06×(1+BHI/50)×1/(1+√(t0/24))；
        区间近似为50%事件发生区间。
      </view>
    </view>
  </view>

  <view class="card">
    <view class="title">维度雷达图</view>
    <view id="radarWrap" class="radar-wrap">
      <canvas id="radar" type="2d" canvas-id="radar" style="width: 100%; height: {{radarH}}px;"></canvas>
    </view>
    <view class="dims">
      <block wx:for="{{dimList}}" wx:key="k">
        <view class="dim"><text class="k">{{item.k}}：</text><text class="v">{{item.v}}</text></view>
      </block>
    </view>
  </view>

  <view class="card">
    <view class="title">分项分析与风险点</view>
    <view class="p">{{empathy}}</view>
    <block wx:for="{{insights}}" wx:key="k">
      <view class="ins">• {{item}}</view>
    </block>
  </view>

  <view class="card">
    <view class="title">个性化建议</view>
    <block wx:for="{{suggestions}}" wx:key="*this">
      <view class="sug">• {{item}}</view>
    </block>
  </view>

  <view class="actions">
    <button bindtap="toIndex">首页</button>
    <button type="primary" open-type="share">分享</button>
    <button class="gen" bindtap="genImage">保存</button>
  </view>

  <!-- 隐藏画布用于生成图片 -->
  <canvas id="poster" type="2d" canvas-id="poster" style="position:absolute;left:-9999px;top:-9999px;width: 320px; height: 560px;"></canvas>
</view>
